# RAG-ассистент с Telegram-ботом

Продвинутый ассистент по Python и DevOps с использованием RAG (Retrieval-Augmented Generation) на базе Yandex Cloud Foundation Models.

## Описание

Проект представляет собой Telegram-бота, который отвечает на вопросы по Python и DevOps, используя базу знаний из markdown-файлов. Бот использует гибридный поиск (векторный + текстовый) для нахождения релевантной информации и генерирует ответы с указанием источников.

### Возможности

- Ответы на вопросы по Python, Docker, Git, FastAPI, pytest и другим технологиям
- RAG-подход: поиск по базе знаний + генерация ответа
- Сохранение контекста диалога (память о предыдущих сообщениях)
- Указание источников информации в ответах
- Команды для управления ботом

### База знаний

Включает 14 markdown-файлов по темам:

- Git — система контроля версий
- Docker — контейнеризация
- Python venv — виртуальные окружения
- pytest — тестирование
- FastAPI — веб-фреймворк
- asyncio — асинхронное программирование
- SQLAlchemy — ORM
- Pydantic — валидация данных
- Poetry — управление зависимостями
- Logging — логирование
- Debugging — отладка
- CI/CD — непрерывная интеграция
- Exceptions — обработка исключений
- HTTP requests — работа с HTTP
- Type hints — аннотации типов

## Требования

- Python 3.10+
- Аккаунт Yandex Cloud
- Telegram Bot Token

## Получение credentials

### 1. Yandex Cloud (YC_FOLDER_ID и YC_API_KEY)

#### Регистрация и создание folder

1. Зарегистрируйтесь на [console.cloud.yandex.ru](https://console.cloud.yandex.ru/)
2. Создайте платёжный аккаунт (для новых пользователей есть грант)
3. Создайте каталог (folder) или используйте существующий
4. Скопируйте **Folder ID** из настроек каталога

#### Получение API Key

1. Перейдите в [IAM → API keys](https://console.cloud.yandex.ru/iam/api-keys)
2. Нажмите "Создать API-ключ"
3. Выберите сервисный аккаунт или создайте новый с ролями:
   - `ai.assistants.editor` — для работы с ассистентами
   - `ai.models.user` — для использования моделей
4. Скопируйте секретный ключ (он показывается только один раз!)

### 2. Telegram Bot Token

1. Откройте Telegram и найдите [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/newbot`
3. Введите имя бота (например: "Python DevOps Assistant")
4. Введите username бота (должен заканчиваться на `bot`, например: `python_devops_assistant_bot`)
5. Скопируйте полученный токен

## Установка

### 1. Клонирование и создание окружения

```bash
# Переход в директорию проекта
cd "задание 7"

# Создание виртуального окружения
python -m venv venv

# Активация (Windows)
venv\Scripts\activate

# Активация (Linux/macOS)
source venv/bin/activate
```

### 2. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 3. Настройка переменных окружения

```bash
# Копирование примера
copy env.example .env      # Windows
cp env.example .env        # Linux/macOS

# Отредактируйте .env и заполните значения:
# YC_FOLDER_ID=ваш_folder_id
# YC_API_KEY=ваш_api_key
# TELEGRAM_BOT_TOKEN=ваш_telegram_token
```

## Запуск

### Шаг 1: Загрузка файлов в Yandex Cloud

```bash
python -m src.upload_files
```

Ожидаемый вывод:

```
==================================================
Загрузка файлов в Yandex Cloud
==================================================
SDK инициализирован
Найдено 14 файлов для загрузки
  ⬆ Загрузка: git.md... ✓ (ID: xxx)
  ⬆ Загрузка: docker.md... ✓ (ID: xxx)
  ...
==================================================
Загружено файлов: 14
Результаты сохранены в: artifacts/uploaded_files.json
==================================================
```

### Шаг 2: Создание поискового индекса

```bash
python -m src.build_index
```

Ожидаемый вывод:

```
==================================================
Создание поискового индекса
==================================================
SDK инициализирован
Найдено 14 файлов для индексации

Создание индекса:
  Создание структуры индекса....... ✓
  Индекс создан: xxx
==================================================
Индекс успешно создан!
ID индекса: xxx
==================================================
```

### Шаг 3: Запуск бота

```bash
python -m src.bot
```

Ожидаемый вывод:

```
==================================================
Запуск Telegram бота
==================================================
Инициализация RAG-ассистента...
Ассистент готов
Бот запущен! Нажмите Ctrl+C для остановки.
==================================================
```

### Альтернатива: Консольный режим

Можно протестировать ассистента без Telegram:

```bash
python -m src.rag_assistant
```

## Использование бота

### Команды

- `/start` — приветственное сообщение и описание возможностей
- `/reset` — сброс контекста диалога (начать новую тему)
- `/help` — справка по использованию

### Примеры вопросов

```
"Как создать виртуальное окружение в Python?"
"Какие основные команды git для работы с ветками?"
"Как запустить контейнер Docker?"
"Что такое pytest fixtures?"
"Объясни async/await в Python"
"Как настроить CI/CD с GitHub Actions?"
```

### Контекстные вопросы

Бот помнит предыдущие сообщения:

```
Вы: Расскажи про asyncio
Бот: [ответ про asyncio]

Вы: А как это работает с pytest?
Бот: [ответ о тестировании async кода с pytest]
```

## Структура проекта

```
задание 7/
├── data/
│   └── knowledge_base/        # Markdown файлы базы знаний
│       ├── git.md
│       ├── docker.md
│       ├── python_venv.md
│       └── ...
├── src/
│   ├── __init__.py
│   ├── upload_files.py        # Загрузка файлов в YC
│   ├── build_index.py         # Создание search index
│   ├── rag_assistant.py       # RAG-ассистент
│   └── bot.py                 # Telegram бот
├── artifacts/                 # Сгенерированные файлы (в .gitignore)
│   ├── uploaded_files.json    # ID загруженных файлов
│   └── index.json             # ID поискового индекса
├── .env                       # Переменные окружения (в .gitignore)
├── env.example                # Пример .env файла
├── .gitignore
├── requirements.txt
└── README.md
```

## Архитектура

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   Telegram      │────▶│   Bot.py        │────▶│ RAG Assistant   │
│   Пользователь  │◀────│                 │◀────│                 │
└─────────────────┘     └─────────────────┘     └────────┬────────┘
                                                         │
                                                         ▼
                                               ┌─────────────────┐
                                               │  Yandex Cloud   │
                                               │  ┌───────────┐  │
                                               │  │ Search    │  │
                                               │  │ Index     │  │
                                               │  └───────────┘  │
                                               │  ┌───────────┐  │
                                               │  │ YandexGPT │  │
                                               │  └───────────┘  │
                                               └─────────────────┘
```

## Тестовые сценарии

### Базовые вопросы

| Вопрос                             | Ожидаемый источник |
| ---------------------------------- | ------------------ |
| Как создать виртуальное окружение? | python_venv.md     |
| Какие команды git для веток?       | git.md             |
| Как запустить docker-compose?      | docker.md          |
| Что такое pytest fixtures?         | pytest.md          |
| Как работает async/await?          | asyncio.md         |

### Проверка контекста

1. Спросите: "Расскажи про FastAPI"
2. Затем: "А как там работает валидация?"
3. Бот должен связать вопрос с FastAPI и упомянуть Pydantic

### Проверка источников

Каждый ответ должен содержать указание источника в формате:

```
Источник: filename.md
```

## Troubleshooting

### Ошибка "Не заданы переменные окружения"

Убедитесь, что:

1. Файл `.env` существует в корне проекта
2. Переменные заполнены без кавычек
3. Нет лишних пробелов

### Ошибка "Файл индекса не найден"

Выполните последовательно:

```bash
python -m src.upload_files
python -m src.build_index
```

### Бот не отвечает

1. Проверьте логи в консоли
2. Убедитесь, что токен бота корректный
3. Попробуйте `/start` для проверки связи

## Лицензия

MIT
