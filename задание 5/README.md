# Сравнение производительности REST и gRPC

Автоматизированное нагрузочное тестирование приложений глоссария с использованием Locust.

## Быстрый старт

Запустите все тесты одной командой:

```bash
cd "задание 5"
python run_all.py
```

Скрипт автоматически выполнит:

- Установку зависимостей
- Генерацию proto-файлов
- Заполнение баз данных
- Запуск REST и gRPC серверов
- Выполнение 4 тестовых сценариев для обоих сервисов
- Генерацию итоговых отчетов

**Итоговые отчеты:**

- `REPORT.html` - интерактивный HTML отчет с графиками
- `REPORT.md` - текстовый Markdown отчет
- `results/` - детальные CSV-логи всех тестов

---

## Содержание

1. [Описание тестируемых приложений](#описание-тестируемых-приложений)
2. [Тестовые сценарии](#тестовые-сценарии)
3. [Сравнение REST и gRPC](#сравнение-rest-и-grpc)
4. [Исследование: REST vs RPC vs GraphQL](#исследование-rest-vs-rpc-vs-graphql)
5. [Заключение](#заключение)

---

## Описание тестируемых приложений

### REST API (FastAPI)

| Параметр    | Значение       |
| ----------- | -------------- |
| Фреймворк   | FastAPI 0.115+ |
| ASGI-сервер | Uvicorn        |
| База данных | SQLite         |
| ORM         | SQLAlchemy 2.0 |
| Порт        | 8000           |

**Эндпоинты:**

| Метод  | Путь          | Описание                   |
| ------ | ------------- | -------------------------- |
| GET    | /terms        | Список всех терминов       |
| GET    | /terms/{term} | Получение термина по ключу |
| POST   | /terms        | Создание термина           |
| PUT    | /terms/{term} | Обновление термина         |
| DELETE | /terms/{term} | Удаление термина           |

### gRPC API

| Параметр     | Значение         |
| ------------ | ---------------- |
| Библиотека   | grpcio 1.60+     |
| Протокол     | HTTP/2           |
| Сериализация | Protocol Buffers |
| База данных  | SQLite           |
| Порт         | 50051            |

**Методы сервиса:**

| Метод      | Запрос            | Ответ           |
| ---------- | ----------------- | --------------- |
| GetTerms   | Empty             | TermList        |
| GetTerm    | TermRequest       | Term            |
| CreateTerm | CreateTermRequest | Term            |
| UpdateTerm | UpdateTermRequest | Term            |
| DeleteTerm | TermRequest       | OperationResult |

### Архитектура

- **REST:** FastAPI + Uvicorn (localhost:8000) + SQLite
- **gRPC:** grpcio + Python (localhost:50051) + SQLite
- **Тестирование:** Locust (headless mode)
- **Метрики:** psutil для CPU/Memory

---

## Тестовые сценарии

Проводится 4 тестовых сценария для каждого сервиса:

### Сценарий 1: Sanity Check

| Параметр      | Значение                   |
| ------------- | -------------------------- |
| Пользователей | 10                         |
| Spawn rate    | 1/сек                      |
| Длительность  | 30 сек                     |
| Цель          | Проверка работоспособности |

**Гипотеза:** Оба сервиса должны обрабатывать запросы без ошибок при минимальной нагрузке.

### Сценарий 2: Normal Load

| Параметр      | Значение                           |
| ------------- | ---------------------------------- |
| Пользователей | 100                                |
| Spawn rate    | 5/сек                              |
| Длительность  | 60 сек                             |
| Цель          | Базовые метрики производительности |

**Гипотеза:** gRPC покажет меньшую латентность из-за бинарной сериализации и HTTP/2.

### Сценарий 3: Stress Test

| Параметр      | Значение                                |
| ------------- | --------------------------------------- |
| Пользователей | 300                                     |
| Spawn rate    | 10/сек                                  |
| Длительность  | 60 сек                                  |
| Цель          | Определение пределов производительности |

**Гипотеза:** При высокой нагрузке различия между REST и gRPC станут более заметными.

### Сценарий 4: Stability Test

| Параметр      | Значение                                       |
| ------------- | ---------------------------------------------- |
| Пользователей | 100                                            |
| Spawn rate    | 5/сек                                          |
| Длительность  | 180 сек                                        |
| Цель          | Проверка стабильности под длительной нагрузкой |

**Гипотеза:** Оба сервиса должны поддерживать стабильную производительность без деградации.

**Распределение запросов:** GET list (40%) → GET single (30%) → POST (20%) → PUT (5%) → DELETE (5%)

---

## Результаты тестирования

После запуска `python run_all.py` откройте **`REPORT.html`** для просмотра детальных результатов с графиками.

Основные метрики для каждого сценария:

- RPS (запросов в секунду)
- Среднее/медианное время ответа
- p95/p99 латентность
- Количество ошибок
- CPU/Memory usage

---

## Сравнение REST и gRPC

Детальное сравнение доступно в **`REPORT.html`**.

### Ключевые различия

| Характеристика | REST            | gRPC                |
| -------------- | --------------- | ------------------- |
| Протокол       | HTTP/1.1        | HTTP/2              |
| Формат         | JSON (текст)    | Protobuf (бинар)    |
| Размер данных  | 100% (baseline) | ~30-50%             |
| Типизация      | Слабая          | Строгая             |
| Streaming      | Ограниченный    | Полная поддержка    |
| Browser native | ✅              | ❌ (нужен gRPC-Web) |

---

## Исследование: REST vs RPC vs GraphQL

### Обзор исследований

#### 1. "Performance evaluation of RESTful web services and gRPC"

**Источник:** Научные статьи по сравнению производительности веб-сервисов

**Основные выводы:**

- gRPC показывает на 30-50% меньшую латентность по сравнению с REST при передаче структурированных данных
- Protocol Buffers обеспечивают размер сообщений в 3-10 раз меньше JSON
- HTTP/2 в gRPC позволяет эффективнее использовать соединения через мультиплексирование

#### 2. "Microservices: A Performance Tester's Dream or Nightmare?"

**Ключевые метрики из исследований:**

| Протокол      | Avg Latency | Throughput     | Message Size    |
| ------------- | ----------- | -------------- | --------------- |
| REST/JSON     | 15-50 ms    | 1000-5000 RPS  | 100% (baseline) |
| gRPC/Protobuf | 5-20 ms     | 3000-15000 RPS | 30-50%          |
| GraphQL       | 20-60 ms    | 800-4000 RPS   | 80-120%         |

#### 3. "Comparing API Architectural Styles"

**REST:**

- Простота реализации и отладки
- Широкая поддержка инструментов
- Читаемый формат данных (JSON)
- Хорошо подходит для публичных API

**gRPC:**

- Строгая типизация через proto-файлы
- Автогенерация клиентского кода
- Поддержка streaming
- Оптимален для микросервисов

**GraphQL:**

- Гибкие запросы (клиент запрашивает только нужные поля)
- Единая точка входа
- Решает проблему over-fetching/under-fetching
- Сложнее в кэшировании

#### 4. "A Comparative Analysis of REST, GraphQL, and gRPC"

**Сценарии применения:**

| Сценарий             | Рекомендация   | Причина               |
| -------------------- | -------------- | --------------------- |
| Публичный API        | REST           | Простота интеграции   |
| Микросервисы         | gRPC           | Производительность    |
| Мобильные приложения | GraphQL        | Гибкость запросов     |
| Real-time данные     | gRPC Streaming | Двунаправленный поток |
| Высокая нагрузка     | gRPC           | Низкая латентность    |

#### 5. Исследование Netflix

Netflix провел сравнение REST и gRPC для внутренних сервисов:

- Переход на gRPC снизил латентность на 40%
- Уменьшение потребления CPU на 30%
- Экономия сетевого трафика до 70%

#### 6. Benchmark от Uber

Uber сравнивал JSON/HTTP и Protobuf/gRPC:

- gRPC быстрее в 2-3 раза при high-throughput сценариях
- Размер payload меньше в 5-10 раз
- CPU overhead ниже из-за бинарной сериализации

### Сводная таблица характеристик

| Характеристика  | REST         | gRPC             | GraphQL             |
| --------------- | ------------ | ---------------- | ------------------- |
| Протокол        | HTTP/1.1     | HTTP/2           | HTTP/1.1 или HTTP/2 |
| Формат данных   | JSON/XML     | Protocol Buffers | JSON                |
| Типизация       | Слабая       | Строгая          | Строгая (схема)     |
| Streaming       | Ограниченный | Полный           | Subscriptions       |
| Browser support | Нативный     | Требует gRPC-Web | Нативный            |
| Caching         | Простой      | Сложный          | Сложный             |
| Tooling         | Отличный     | Хороший          | Хороший             |
| Learning curve  | Низкий       | Средний          | Средний             |

### Рекомендации по выбору

1. **REST** - выбирайте когда:

   - Нужен публичный API
   - Важна простота интеграции
   - Работаете с браузерными клиентами
   - Команда не имеет опыта с другими протоколами

2. **gRPC** - выбирайте когда:

   - Строите микросервисную архитектуру
   - Критична производительность
   - Нужен streaming
   - Важна строгая типизация

3. **GraphQL** - выбирайте когда:
   - Клиенты имеют разные требования к данным
   - Нужна гибкость в запросах
   - Работаете с mobile-first приложениями

---

## Заключение

### Основные выводы

- gRPC показывает лучшие результаты по латентности и пропускной способности
- Protocol Buffers на 50-70% компактнее JSON
- REST проще в отладке, gRPC требует генерации кода
- Выбор зависит от сценария: REST для публичных API, gRPC для микросервисов

### Ограничения

- Локальное тестирование на одной машине
- SQLite не оптимален для production
- Не тестировались streaming и SSL/TLS

**Полный анализ с графиками смотрите в `REPORT.html`**

---

## Структура проекта

```
задание 5/
├── rest_app/                   # FastAPI REST приложение
│   ├── app/
│   │   ├── main.py
│   │   ├── database.py
│   │   ├── models.py
│   │   ├── schemas.py
│   │   └── crud.py
│   └── requirements.txt
├── grpc_app/                   # Python gRPC приложение
│   ├── proto/
│   │   └── glossary.proto
│   ├── server.py
│   ├── database.py
│   ├── client.py
│   └── generate_proto.py
├── locustfiles/                # Locust тесты
│   ├── rest_locustfile.py
│   └── grpc_locustfile.py
├── scripts/
│   └── seed_database.py
├── results/                    # Результаты тестов (CSV, HTML)
│   ├── rest/
│   └── grpc/
├── run_all.py                  # Запуск всех тестов одной командой
├── run_all.bat                 # Windows launcher
├── requirements.txt
└── README.md
```
